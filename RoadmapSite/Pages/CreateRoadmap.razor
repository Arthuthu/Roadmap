@page "/createroadmap"
@inject IRoadmapService roadmapServiceService
@inject IUserService userService
@inject AuthenticationStateProvider _authenticationStateProvider
@inject NavigationManager navManager

<AuthorizeView>
	<Authorized>
		<EditForm Model="roadmap" OnValidSubmit="ExecuteRoadmapCreation" Context="Form">
			<div class="form-div">
				<div class="iniciar-sessao-paragraph">
					<p>Criar roadmap</p>
				</div>

				<div class="first-form-label">
					<label for="name" class="visually-hidden">Nome</label>
					<div>
						<InputText id="name" class="form-input-text" @bind-Value="roadmap.Name" placeholder="Nome do Roadmap" />
					</div>
				</div>

				<div class="other-form-label">
					<label for="description" class="visually-hidden">Descrição</label>
					<div>
						<InputTextArea id="description" class="form-input-text-description" @bind-Value="roadmap.Description" placeholder="Descrição (Maximo 500 caracteres)" />
					</div>
				</div>

				<div class="other-form-label">
					<label for="category" class="visually-hidden">Categoria</label>
					<div>
						<InputText id="category" class="form-input-text" @bind-Value="roadmap.Category" placeholder="Categoria" />
					</div>
				</div>

				<div class="text-center">
					<button type="submit" class="first-style-button">Criar Roadmap</button>
				</div>
			</div>
		</EditForm>
	</Authorized>

	<NotAuthorized>
		<div class="not-authorized-message-div">
			<div class="not-authorized-message-p-div">
				<p class="not-authorized-message">Você não esta autorizado para ver esta pagina, entre em uma conta primeiro</p>
			</div>
			<div>
				<a class="first-style-button" href="login">
					Entrar
				</a>
			</div>
		</div>
	</NotAuthorized>
</AuthorizeView>
<div role="alert" class="alert-message-div">
	<p class="alert-message">@roadmapCreationMessage</p>
</div>

@code {
	private Guid LoggedInUserId { get; set; }
	private RoadmapClassModel roadmap = new();
	private string roadmapCreationMessage = "";

	protected override async Task OnInitializedAsync()
	{
		await GetLoggedInUserId();

		if (LoggedInUserId == Guid.Empty)
		{
			navManager.NavigateTo("/login");
		}
	}

	private async Task GetLoggedInUserId()
	{
		LoggedInUserId = await userService.GetLoggedInUserId();
	}

	private async Task<string> ExecuteRoadmapCreation()
	{
		roadmap.UserId = LoggedInUserId;

		var result = await roadmapServiceService.CreateRoadmap(roadmap);

		roadmapCreationMessage = result;

		if (roadmapCreationMessage != "Roadmap criado com sucesso")
		{
			return "";
		}

		navManager.NavigateTo($"/profile/{LoggedInUserId}");

		return "";
	}
}